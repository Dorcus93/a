<!DOCTYPE html>
<html>
<head>
    <title>ì¢…í•© ì•ˆì „ ë°©íƒˆì¶œ ê²Œì„</title>
    <meta charset="UTF-8">
    <style>
        /* --- ê³µí†µ ìŠ¤íƒ€ì¼ --- */
        body {
            font-family: 'Malgun Gothic', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .game-wrapper { text-align: center; }

        .game-container {
            position: relative;
            width: 800px;
            height: 600px;
            margin: 20px auto;
            background-color: #fff;
            border: 1px solid #ccc;
            overflow: hidden;
        }

        .room-image { width: 100%; height: 100%; object-fit: cover; }
        
        .object {
            position: absolute;
            background-color: rgba(255, 255, 0, 0.0);
            cursor: pointer;
            transition: background-color 0.3s;
            border: 2px dashed rgba(255, 0, 0, 0);
        }

        .object:hover { background-color: rgba(255, 255, 0, 0.4); border: 2px dashed red; }
        
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 10;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            width: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .modal-content h2 { margin-top: 0; }
        .modal-content p { line-height: 1.6; }
        .modal-content button {
            padding: 10px 20px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px 0 5px;
        }
        .modal-content button:hover { background-color: #0056b3; }
        
        .close-button { position: absolute; top: 15px; right: 15px; font-size: 24px; cursor: pointer; color: #aaa; }
        .close-button:hover { color: #000; }
        .password-hint { color: blue; font-weight: bold; margin-top: 15px; }
        
        #start-screen { text-align: center; }
        #start-screen input { margin: 10px; padding: 5px; }

        .timer { position: absolute; top: 20px; right: 20px; font-size: 20px; background: white; padding: 5px 10px; border-radius: 5px;}

        /* --- 1ë‹¨ê³„ (êµì‹¤) ìŠ¤íƒ€ì¼ --- */
        #stage1-container .object:hover { background-color: rgba(255, 0, 0, 0.3); border: none; }
        #monitor-1 { top: 40%; left: 30%; width: 80px; height: 50px; }
        #clock-1 { top: 19%; right: 73%; width: 40px; height: 40px; border-radius: 50%; }
        #board-1 { top: 25%; left: 50%; width: 150px; height: 80px; transform: translateX(-50%); }
        #bookshelf-1 { top: 40%; right: 25%; width: 70px; height: 150px; }
        #door-1 { bottom: 50%; left: 80%; width: 100px; height: 180px; }
        #missile-game-1 { width: 400px; height: 300px; background-color: #000; position: relative; overflow: hidden; margin: auto;}
        #player-1 { width: 20px; height: 20px; background-color: white; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); }
        .missile-1 { width: auto; height: auto; background-color: red; position: absolute; top: 0; color: white; font-size: 10px; padding: 3px; word-break: break-word; border-radius: 3px; }
        #game-message-1 { color: white; font-size: 20px; text-align: center; margin-top: 100px; display: none; }

        /* --- 2ë‹¨ê³„ (ê¸‰ì‹ì‹¤) ìŠ¤íƒ€ì¼ --- */
        #refrigerator-2 { top: 0%; left: 90%; width: 13%; height: 50%; }
        #serving-counter-2 { top: 8%; left: 50%; width: 35%; height: 20%; }
        #bowl-2 { top: 51%; left: 0%; width: 8%; height: 9%; }
        #spoon-2 { top: 76%; left: 84%; width: 8%; height: 9%; }
        #door-2 { top: 0%; left: 25%; width: 14%; height: 53%; }
        #memory-game-2 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; width: 320px; margin: 20px auto; }
        .card-2 { width: 70px; height: 70px; background-color: #ddd; display: flex; justify-content: center; align-items: center; font-size: 30px; cursor: pointer; position: relative; transform-style: preserve-3d; transition: transform 0.5s; }
        .card-2 .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; justify-content: center; align-items: center; border-radius: 5px; }
        .card-2 .card-front { background-color: #007bff; }
        .card-2 .card-back { background-color: #fff; color: #333; transform: rotateY(180deg); border: 1px solid #ccc; }
        .card-2.is-flipped { transform: rotateY(180deg); }
        .card-2.is-matched { background-color: #28a745; cursor: default; }
        .card-2.is-matched .card-front { background-color: #28a745; }

        /* --- 3ë‹¨ê³„ (í™”ì¥ì‹¤) ìŠ¤íƒ€ì¼ --- */
        #urinal-3 { top: 30%; left: 0%; width: 10%; height: 30%; }
        #sink-3 { top: 40%; left: 55%; width: 20%; height: 25%; }
        #toilet-paper-3 { top: 15%; left: 48%; width: 8%; height: 10%; }
        #trash-can-3 { top: 68%; left: 47%; width: 10%; height: 20%; }
        #toilet-3 { top: 32%; left: 28%; width: 12%; height: 55%; }
        #bullet-hell-game-3 { width: 400px; height: 300px; background-color: #d4f1f9; position: relative; overflow: hidden; border: 2px solid #333; margin: auto; }
        #player-3 { width: 30px; height: 30px; font-size: 25px; position: absolute; bottom: 5px; left: 185px; }
        .bullet-3 { width: 20px; height: 20px; font-size: 20px; position: absolute; top: -20px; }
        #game-info-3 { margin-top: 15px; font-size: 18px; }
    </style>
</head>
<body>

<div class="game-wrapper">
    <!-- ì‹œì‘ í™”ë©´ -->
    <div id="start-screen">
        <h1>ì¢…í•© ì•ˆì „ ë°©íƒˆì¶œ ê²Œì„</h1>
        <p>êµì‹¤, ê¸‰ì‹ì‹¤, í™”ì¥ì‹¤ì— ìˆ¨ê²¨ì§„ ì•ˆì „ ìˆ˜ì¹™ì„ ì°¾ì•„ íƒˆì¶œí•˜ì„¸ìš”!</p>
        <input type="text" id="grade" placeholder="í•™ë…„">
        <input type="text" id="class" placeholder="ë°˜">
        <input type="text" id="name" placeholder="ì´ë¦„">
        <button onclick="startGame()">ê²Œì„ ì‹œì‘</button>
    </div>

    <!-- 1ë‹¨ê³„: êµì‹¤ -->
    <div id="stage1-container" class="game-container" style="display: none;">
        <img class="room-image" src="https://i.ibb.co/PvK1FJcb/Whisk-storyboardb57be9d678c6479aaaa93723.jpg" alt="êµì‹¤ ì´ë¯¸ì§€">
        <div class="object" id="monitor-1"></div> <div class="object" id="clock-1"></div> <div class="object" id="board-1"></div> <div class="object" id="bookshelf-1"></div> <div class="object" id="door-1"></div>
        <div class="timer" id="timer-1">ì†Œìš” ì‹œê°„: <span id="time-elapsed-1">00:00</span></div>
        <!-- 1ë‹¨ê³„ ëª¨ë‹¬ë“¤ -->
        <div id="hint-container-1" class="modal"><div class="modal-content"><span class="close-button" onclick="this.parentElement.parentElement.style.display='none'">Ã—</span><h2>ì•ˆì „ íŒíŠ¸</h2><p>ì†Œí™”ê¸° ì‚¬ìš©ë²•ì„ í™•ì¸í•˜ì„¸ìš”!</p><label><input type="radio" name="answer1_3" value="1"> 1.ì•ˆì „í•€ ë½‘ê³  ì†ì¡ì´ ì¡ê³  ë¶ˆì„ í–¥í•´ ë¶„ì‚¬</label><br><label><input type="radio" name="answer1_3" value="2"> 2.ì†ì¡ì´ ì¡ê³  ì•ˆì „í•€ ë½‘ê³  ë¶ˆì„ í–¥í•´ ë¶„ì‚¬</label><br><label><input type="radio" name="answer1_3" value="3"> 3. ë¶ˆì„ í–¥í•´ ê·¸ëƒ¥ ë¶„ì‚¬</label><br><button onclick="checkAnswer1_3()">ì •ë‹µ í™•ì¸</button><p id="result1_3"></p><p id="password-hint1_3" class="password-hint"></p></div></div>
        <div id="puzzle1-container-1" class="modal"><div class="modal-content"><span class="close-button" onclick="this.parentElement.parentElement.style.display='none'">Ã—</span><h2>ë¬¸ì œ 1</h2><p>í™”ì¬ ë°œìƒ ì‹œ ê°€ì¥ ë¨¼ì € í•´ì•¼ í•  ì¼ì€?</p><label><input type="radio" name="answer1_1" value="1"> 1. ë¶ˆ ë„ê¸°</label><br><label><input type="radio" name="answer1_1" value="2"> 2. ì‹ ê³ í•˜ê¸°</label><br><label><input type="radio" name="answer1_1" value="3"> 3. ë„ë§ê°€ê¸°</label><br><button onclick="checkAnswer1_1()">ì •ë‹µ í™•ì¸</button><p id="result1_1"></p><p id="password-hint1_1" class="password-hint"></p></div></div>
        <div id="puzzle2-container-1" class="modal"><div class="modal-content"><span class="close-button" onclick="this.parentElement.parentElement.style.display='none'">Ã—</span><h2>ë¬¸ì œ 2</h2><p>ì§€ì§„ ë°œìƒ ì‹œ ì±…ìƒ ì•„ë˜ë¡œ ìˆ¨ëŠ” ì´ìœ ëŠ”?</p><label><input type="radio" name="answer1_2" value="1"> 1. ë”°ëœ»í•´ì„œ</label><br><label><input type="radio" name="answer1_2" value="2"> 2. ë‚™í•˜ë¬¼ë¡œë¶€í„° ë³´í˜¸</label><br><label><input type="radio" name="answer1_2" value="3"> 3. ì¬ë¯¸ìˆì–´ì„œ</label><br><button onclick="checkAnswer1_2()">ì •ë‹µ í™•ì¸</button><p id="result1_2"></p><p id="password-hint1_2" class="password-hint"></p></div></div>
        <div id="missile-game-container-1" class="modal"><div class="modal-content"><span class="close-button" onclick="closeMissileGame1()">Ã—</span><h2>ë¯¸ì‚¬ì¼ ë¨¹ê¸° ê²Œì„</h2><div id="missile-game-1"></div><p id="password-hint-missile-1" class="password-hint"></p></div></div>
        <div id="password-modal-1" class="modal"><div class="modal-content"><span class="close-button" onclick="this.parentElement.parentElement.style.display='none'">Ã—</span><h2>1ë‹¨ê³„ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h2><input type="password" id="password-1" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"><button onclick="checkPassword1()">íƒˆì¶œ ì‹œë„</button><p id="escape-result-1"></p></div></div>
    </div>

    <!-- 2ë‹¨ê³„: ê¸‰ì‹ì‹¤ -->
    <div id="stage2-container" class="game-container" style="display: none;">
        <img class="room-image" src="https://i.ibb.co/13pqBZd/Whisk-4aca4d0fc8-1.jpg" alt="ê¸‰ì‹ì‹¤ ë°°ê²½ ì´ë¯¸ì§€">
        <div class="object" id="refrigerator-2"></div> <div class="object" id="serving-counter-2"></div> <div class="object" id="bowl-2"></div> <div class="object" id="spoon-2"></div> <div class="object" id="door-2"></div>
        <div class="timer" id="timer-2">ì†Œìš” ì‹œê°„: <span id="time-elapsed-2">00:00</span></div>
        <!-- 2ë‹¨ê³„ ëª¨ë‹¬ë“¤ -->
        <div id="puzzle1-container-2" class="modal"><div class="modal-content"><span class="close-button" onclick="this.parentElement.parentElement.style.display='none'">Ã—</span><h2>ë‘ ë²ˆì§¸ ë¬¸ì œ</h2><p>ì‹ì¤‘ë…ì„ ì˜ˆë°©í•˜ê¸° ìœ„í•œ ëƒ‰ì¥ê³ ì˜ ê°€ì¥ ì•ˆì „í•œ ì ì • ë³´ê´€ ì˜¨ë„ëŠ”?</p><label><input type="radio" name="answer2_1" value="wrong"> 1. 10â„ƒ ì´í•˜</label><label><input type="radio" name="answer2_1" value="correct"> 2. 5â„ƒ ì´í•˜</label><label><input type="radio" name="answer2_1" value="wrong"> 3. 0â„ƒ (ëƒ‰ë™)</label><button onclick="checkAnswer2(1, '2')">ì •ë‹µ í™•ì¸</button><button onclick="this.parentElement.parentElement.style.display='none'">ë‹«ê¸°</button><p id="result2_1"></p></div></div>
        <div id="puzzle2-container-2" class="modal"><div class="modal-content"><span class="close-button" onclick="this.parentElement.parentElement.style.display='none'">Ã—</span><h2>ì„¸ ë²ˆì§¸ ë¬¸ì œ</h2><p>ë°°ì‹ì´ ì‹œì‘ëœ ìŒì‹ì€ ê°€ê¸‰ì  ëª‡ ì‹œê°„ ì´ë‚´ì— ì„­ì·¨í•´ì•¼ ê°€ì¥ ì•ˆì „í• ê¹Œìš”?</p><label><input type="radio" name="answer2_2" value="correct"> 1. 2ì‹œê°„ ì´ë‚´</label><label><input type="radio" name="answer2_2" value="wrong"> 2. 4ì‹œê°„ ì´ë‚´</label><label><input type="radio" name="answer2_2" value="wrong"> 3. 6ì‹œê°„ ì´ë‚´</label><button onclick="checkAnswer2(2, '0')">ì •ë‹µ í™•ì¸</button><button onclick="this.parentElement.parentElement.style.display='none'">ë‹«ê¸°</button><p id="result2_2"></p></div></div>
        <div id="puzzle3-container-2" class="modal"><div class="modal-content"><span class="close-button" onclick="this.parentElement.parentElement.style.display='none'">Ã—</span><h2>ë„¤ ë²ˆì§¸ ë¬¸ì œ</h2><p>ì‚¬ìš©í•œ ì‹ê¸°ë¥¼ ë°˜ë‚©í•  ë•Œ, ë‹¤ìŒ ì¤‘ ê°€ì¥ ì˜¬ë°”ë¥´ì§€ **ì•Šì€** í–‰ë™ì€?</p><label><input type="radio" name="answer2_3" value="wrong"> 1. ìˆ˜ì €ì™€ ê·¸ë¦‡ì„ ë¶„ë¦¬í•˜ì—¬ ë°˜ë‚©í•œë‹¤.</label><label><input type="radio" name="answer2_3" value="wrong"> 2. ë‚¨ì€ ìŒì‹ë¬¼ì„ ì”ë°˜í†µì— ë²„ë¦°ë‹¤.</label><label><input type="radio" name="answer2_3" value="correct"> 3. ì¹œêµ¬ì™€ ì¥ë‚œì¹˜ë©° ë˜ì§€ë“¯ì´ ë°˜ë‚©í•œë‹¤.</label><button onclick="checkAnswer2(3, '2')">ì •ë‹µ í™•ì¸</button><button onclick="this.parentElement.parentElement.style.display='none'">ë‹«ê¸°</button><p id="result2_3"></p></div></div>
        <div id="memory-game-container-2" class="modal"><div class="modal-content"><span class="close-button" onclick="this.parentElement.parentElement.style.display='none'">Ã—</span><h2>ë©”ëª¨ë¦¬ ì¹´ë“œ ê²Œì„</h2><p>ê°™ì€ ê·¸ë¦¼ì˜ ì¹´ë“œë¥¼ ì°¾ì•„ ì§ì„ ë§ì¶”ì„¸ìš”!</p><div id="memory-game-2"></div><p id="result-memory-2"></p></div></div>
        <div id="password-modal-2" class="modal"><div class="modal-content"><span class="close-button" onclick="this.parentElement.parentElement.style.display='none'">Ã—</span><h2>2ë‹¨ê³„ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h2><p>ì°¾ì•„ë‚¸ 4ê°œì˜ ìˆ«ìë¥¼ ì¡°í•©í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš”.</p><input type="password" id="password-2" placeholder="ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬"><button onclick="checkPassword2()">íƒˆì¶œ ì‹œë„</button><p id="escape-result-2"></p></div></div>
    </div>
    
    <!-- 3ë‹¨ê³„: í™”ì¥ì‹¤ -->
    <div id="stage3-container" class="game-container" style="display: none;">
        <img class="room-image" src="https://i.ibb.co/SDxgmD7Q/Whisk-18bd079520.jpg" alt="í™”ì¥ì‹¤ ë°°ê²½ ì´ë¯¸ì§€">
        <div class="object" id="urinal-3"></div> <div class="object" id="sink-3"></div> <div class="object" id="toilet-paper-3"></div> <div class="object" id="trash-can-3"></div> <div class="object" id="toilet-3"></div>
        <div class="timer" id="timer-3">ì†Œìš” ì‹œê°„: <span id="time-elapsed-3">00:00</span></div>
        <!-- 3ë‹¨ê³„ ëª¨ë‹¬ë“¤ -->
        <div id="puzzle1-container-3" class="modal"><div class="modal-content"><span class="close-button" onclick="this.parentElement.parentElement.style.display='none'">Ã—</span><h2>ë‹¤ì„¯ ë²ˆì§¸ ë¬¸ì œ</h2><p>ì†Œë³€ê¸°ë¥¼ ì‚¬ìš©í•œ í›„, ë¬¼ì„ ë‚´ë¦¬ëŠ” ê²ƒ ì™¸ì—<br>ê°€ì¥ ë¨¼ì € í™•ì¸í•´ì•¼ í•  ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?</p><label><input type="radio" name="answer3_1" value="correct"> 1. ì£¼ë³€ì— ë¬¼ì´ íŠ€ê±°ë‚˜ ë°”ë‹¥ì´ ë¯¸ë„ëŸ½ì§€ ì•Šì€ì§€ í™•ì¸</label><label><input type="radio" name="answer3_1" value="wrong"> 2. ë‹¤ìŒ ì‚¬ëŒì„ ìœ„í•´ ë°©í–¥ì œë¥¼ ë¿Œë ¤ì£¼ê¸°</label><label><input type="radio" name="answer3_1" value="wrong"> 3. ì†Œë³€ê¸° ì˜†ì— ë‚™ì„œê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê¸°</label><button onclick="checkAnswer3(1, '0')">ì •ë‹µ í™•ì¸</button><p id="result3_1"></p></div></div>
        <div id="puzzle2-container-3" class="modal"><div class="modal-content"><span class="close-button" onclick="this.parentElement.parentElement.style.display='none'">Ã—</span><h2>ì—¬ì„¯ ë²ˆì§¸ ë¬¸ì œ</h2><p>ì„¸ë©´ëŒ€ì—ì„œ ì†ì„ ì”»ì€ í›„, ê°€ì¥ ì•ˆì „í•œ í–‰ë™ì€ ë¬´ì—‡ì¼ê¹Œìš”?</p><label><input type="radio" name="answer3_2" value="wrong"> 1. ì –ì€ ì†ìœ¼ë¡œ ì¹œêµ¬ì™€ ì¥ë‚œì¹˜ê¸°</label><label><input type="radio" name="answer3_2" value="correct"> 2. ì†ì˜ ë¬¼ê¸°ë¥¼ ì™„ì „íˆ ë‹¦ì•„ ë°”ë‹¥ì— ë¬¼ì´ ë–¨ì–´ì§€ì§€ ì•Šê²Œ í•˜ê¸°</label><label><input type="radio" name="answer3_2" value="wrong"> 3. ë¬¼ì„ í‹€ì–´ë†“ê³  ìë¦¬ ë¹„ìš°ê¸°</label><button onclick="checkAnswer3(2, '6')">ì •ë‹µ í™•ì¸</button><p id="result3_2"></p></div></div>
        <div id="puzzle3-container-3" class="modal"><div class="modal-content"><span class="close-button" onclick="this.parentElement.parentElement.style.display='none'">Ã—</span><h2>ì¼ê³± ë²ˆì§¸ ë¬¸ì œ</h2><p>í™”ì¥ì‹¤ ì“°ë ˆê¸°í†µ ì‚¬ìš©ë²•ìœ¼ë¡œ ì˜¬ë°”ë¥´ì§€ **ì•Šì€** ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?</p><label><input type="radio" name="answer3_3" value="wrong"> 1. ì‚¬ìš©í•œ íœ´ì§€ëŠ” ê¼­ ì“°ë ˆê¸°í†µì— ë²„ë¦°ë‹¤.</label><label><input type="radio" name="answer3_3" value="wrong"> 2. ì“°ë ˆê¸°ê°€ ë„˜ì¹˜ì§€ ì•Šë„ë¡ ì¡°ì‹¬í•œë‹¤.</label><label><input type="radio" name="answer3_3" value="correct"> 3. ë‹¤ë¥¸ ì‚¬ëŒì´ ë²„ë¦° ì“°ë ˆê¸°ë¥¼ ë°œë¡œ ë°Ÿì•„ ë„£ëŠ”ë‹¤.</label><button onclick="checkAnswer3(3, '2')">ì •ë‹µ í™•ì¸</button><p id="result3_3"></p></div></div>
        <div id="minigame-container-3" class="modal"><div class="modal-content"><span class="close-button" onclick="closeMiniGame3()">Ã—</span><h2>ë¯¸ë‹ˆê²Œì„: ë¬¼ë°©ìš¸ í”¼í•˜ê¸°!</h2><p>ë°”ë‹¥ì˜ ë¬¼ê¸°ëŠ” ë¯¸ë„ëŸ¬ì›Œ ìœ„í—˜í•´ìš”.<br>15ì´ˆ ë™ì•ˆ ë–¨ì–´ì§€ëŠ” ë¬¼ë°©ìš¸ì„ í”¼í•˜ì„¸ìš”!</p><div id="bullet-hell-game-3"><div id="player-3">ğŸƒ</div></div><p id="game-info-3">ì¤€ë¹„!</p></div></div>
        <div id="password-modal-3" class="modal"><div class="modal-content"><span class="close-button" onclick="this.parentElement.parentElement.style.display='none'">Ã—</span><h2>ìµœì¢… ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h2><p>ì°¾ì•„ë‚¸ 4ê°œì˜ ìˆ«ìë¥¼ ì¡°í•©í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš”.</p><input type="password" id="password-3" placeholder="ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬"><button onclick="checkPassword3()">íƒˆì¶œ ì‹œë„</button><p id="escape-result-3"></p></div></div>
    </div>
</div>

<script>
    // --- ì „ì—­ ë³€ìˆ˜ ---
    let startTime1, timerInterval1;
    let startTime2, timerInterval2;
    let startTime3, timerInterval3;

    // --- ê²Œì„ ì‹œì‘ í•¨ìˆ˜ ---
    function startGame() {
        const grade = document.getElementById('grade').value;
        const classValue = document.getElementById('class').value;
        const name = document.getElementById('name').value;
        if (!grade || !classValue || !name) {
            alert('í•™ë…„, ë°˜, ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('stage1-container').style.display = 'block';
        startTime1 = new Date();
        timerInterval1 = setInterval(updateTimer1, 1000);
    }
    
    // --- íƒ€ì´ë¨¸ í•¨ìˆ˜ ---
    function updateTimer1() { updateTimer('1'); }
    function updateTimer2() { updateTimer('2'); }
    function updateTimer3() { updateTimer('3'); }

    function updateTimer(stage) {
        const now = new Date();
        let startTime = window[`startTime${stage}`];
        const timeDiff = now.getTime() - startTime.getTime();
        const minutes = String(Math.floor(timeDiff / 60000)).padStart(2, '0');
        const seconds = String(Math.floor((timeDiff % 60000) / 1000)).padStart(2, '0');
        document.getElementById(`time-elapsed-${stage}`).innerText = `${minutes}:${seconds}`;
    }

    // ==========================================================
    // --- 1ë‹¨ê³„ (êµì‹¤) ìŠ¤í¬ë¦½íŠ¸ ---
    // ==========================================================
    document.getElementById('monitor-1').addEventListener('click', () => document.getElementById('hint-container-1').style.display = 'flex');
    document.getElementById('clock-1').addEventListener('click', () => document.getElementById('puzzle1-container-1').style.display = 'flex');
    document.getElementById('board-1').addEventListener('click', () => document.getElementById('puzzle2-container-1').style.display = 'flex');
    document.getElementById('bookshelf-1').addEventListener('click', () => {
        document.getElementById('missile-game-container-1').style.display = 'flex';
        startGameMissile1();
    });
    document.getElementById('door-1').addEventListener('click', () => document.getElementById('password-modal-1').style.display = 'flex');

    function checkAnswer1_3() { const selected = document.querySelector('input[name="answer1_3"]:checked'); if (selected && selected.value === '1') { document.getElementById('result1_3').innerText = 'ì •ë‹µì…ë‹ˆë‹¤!'; document.getElementById('password-hint1_3').innerText = 'ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸: 1'; } else { document.getElementById('result1_3').innerText = 'ì˜¤ë‹µì…ë‹ˆë‹¤.'; } }
    function checkAnswer1_1() { const selected = document.querySelector('input[name="answer1_1"]:checked'); if (selected && selected.value === '2') { document.getElementById('result1_1').innerText = 'ì •ë‹µì…ë‹ˆë‹¤!'; document.getElementById('password-hint1_1').innerText = 'ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸: 2'; } else { document.getElementById('result1_1').innerText = 'ì˜¤ë‹µì…ë‹ˆë‹¤.'; } }
    function checkAnswer1_2() { const selected = document.querySelector('input[name="answer1_2"]:checked'); if (selected && selected.value === '2') { document.getElementById('result1_2').innerText = 'ì •ë‹µì…ë‹ˆë‹¤!'; document.getElementById('password-hint1_2').innerText = 'ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸: 0'; } else { document.getElementById('result1_2').innerText = 'ì˜¤ë‹µì…ë‹ˆë‹¤.'; } }

    let playerX1, score1, gameTimer1, missiles1;
    const safetyRules1 = [{ text: "í™”ì¬ ì‹œ 119", isCorrect: true }, { text: "ì§€ì§„ ì‹œ ì±…ìƒ ë°‘", isCorrect: true }, { text: "ë³µë„ì—ì„œ ë›°ê¸°", isCorrect: false }, { text: "ì†Œí™”ê¸° ìˆ™ì§€", isCorrect: true }, { text: "ì –ì€ ì† ì „ê¸°", isCorrect: false }];

    function startGameMissile1() { const missileGame = document.getElementById('missile-game-1'); missileGame.innerHTML = '<div id="player-1"></div><div id="game-message-1"></div>'; playerX1 = 190; score1 = 0; missiles1 = []; const player = document.getElementById('player-1'); const gameMessage = document.getElementById('game-message-1'); player.style.left = playerX1 + 'px'; gameMessage.style.display = 'block'; gameMessage.innerText = "ì•ˆì „ ìˆ˜ì¹™ì„ ë¨¹ì–´ë¼!\nì ìˆ˜: " + score1; document.getElementById('password-hint-missile-1').innerText = ''; document.addEventListener('keydown', movePlayer1); gameTimer1 = setInterval(createMissile1, 1000); }
    function closeMissileGame1() { document.getElementById('missile-game-container-1').style.display = 'none'; clearInterval(gameTimer1); document.removeEventListener('keydown', movePlayer1); }
    function movePlayer1(e) { const player = document.getElementById('player-1'); if (!player) return; if (e.key === 'ArrowLeft') playerX1 -= 20; if (e.key === 'ArrowRight') playerX1 += 20; if (playerX1 < 0) playerX1 = 0; if (playerX1 > 380) playerX1 = 380; player.style.left = playerX1 + 'px'; }
    function createMissile1() { const missileGame = document.getElementById('missile-game-1'); if (!missileGame) return; const missileElement = document.createElement('div'); missileElement.classList.add('missile-1'); const randomRule = safetyRules1[Math.floor(Math.random() * safetyRules1.length)]; missileElement.innerText = randomRule.text; missileElement.isCorrect = randomRule.isCorrect; missileElement.style.left = Math.random() * 320 + 'px'; missileGame.appendChild(missileElement); moveMissile1(missileElement); }
    function moveMissile1(missileElement) { let top = 0; const interval = setInterval(() => { top += 5; missileElement.style.top = top + 'px'; if (top > 300) { clearInterval(interval); missileElement.remove(); } if (checkCollision1(missileElement)) { clearInterval(interval); missileElement.remove(); } }, 50); }
    function checkCollision1(missileElement) { const player = document.getElementById('player-1'); if (!player) return false; const playerRect = player.getBoundingClientRect(); const missileRect = missileElement.getBoundingClientRect(); if (playerRect.left < missileRect.right && playerRect.right > missileRect.left && playerRect.top < missileRect.bottom && playerRect.bottom > missileRect.top) { if (missileElement.isCorrect) { score1 += 10; document.getElementById('game-message-1').innerText = "ì•ˆì „ ìˆ˜ì¹™ì„ ë¨¹ì–´ë¼!\nì ìˆ˜: " + score1; if (score1 >= 50) gameWin1(); } else { gameOver1(); } return true; } return false; }
    function gameWin1() { clearInterval(gameTimer1); document.removeEventListener('keydown', movePlayer1); document.getElementById('game-message-1').innerText = 'ì„±ê³µ!'; document.getElementById('password-hint-missile-1').innerText = 'ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸: 3'; }
    function gameOver1() { clearInterval(gameTimer1); document.removeEventListener('keydown', movePlayer1); document.getElementById('game-message-1').innerText = 'ì‹¤íŒ¨! ì˜¤ë‹µì…ë‹ˆë‹¤.'; }
    
    function checkPassword1() {
        if (document.getElementById('password-1').value === '2013') {
            clearInterval(timerInterval1);
            alert('1ë‹¨ê³„ íƒˆì¶œ ì„±ê³µ! 2ë‹¨ê³„ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
            document.getElementById('stage1-container').style.display = 'none';
            document.getElementById('stage2-container').style.display = 'block';
            startTime2 = new Date();
            timerInterval2 = setInterval(updateTimer2, 1000);
        } else {
            document.getElementById('escape-result-1').innerText = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.';
        }
    }

    // ==========================================================
    // --- 2ë‹¨ê³„ (ê¸‰ì‹ì‹¤) ìŠ¤í¬ë¦½íŠ¸ ---
    // ==========================================================
    document.getElementById('refrigerator-2').addEventListener('click', () => document.getElementById('puzzle1-container-2').style.display = 'flex');
    document.getElementById('serving-counter-2').addEventListener('click', () => document.getElementById('puzzle2-container-2').style.display = 'flex');
    document.getElementById('bowl-2').addEventListener('click', () => document.getElementById('puzzle3-container-2').style.display = 'flex');
    document.getElementById('spoon-2').addEventListener('click', () => { document.getElementById('memory-game-container-2').style.display = 'flex'; startMemoryGame2(); });
    document.getElementById('door-2').addEventListener('click', () => document.getElementById('password-modal-2').style.display = 'flex');

    function checkAnswer2(puzzleNum, hint) { const selected = document.querySelector(`input[name="answer2_${puzzleNum}"]:checked`); const resultEl = document.getElementById(`result2_${puzzleNum}`); if (selected) { if (selected.value === 'correct') { resultEl.innerHTML = `<span style="color:blue;">ì •ë‹µì…ë‹ˆë‹¤! ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸: <strong>${hint}</strong></span>`; } else { resultEl.innerText = 'ì˜¤ë‹µì…ë‹ˆë‹¤. ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”.'; } } else { resultEl.innerText = 'ë‹µì„ ì„ íƒí•´ì£¼ì„¸ìš”.'; } }
    
    let flippedCards2 = [], matchedPairs2 = 0, lockBoard2 = false;
    function startMemoryGame2() { const symbols = ['ğŸ', 'ğŸ¥•', 'ğŸ§¼', 'ğŸ’§', 'ğŸ”¥', 'âŒ']; let cards = [...symbols, ...symbols]; cards.sort(() => 0.5 - Math.random()); const gameBoard = document.getElementById('memory-game-2'); gameBoard.innerHTML = ''; document.getElementById('result-memory-2').innerText = ''; matchedPairs2 = 0; cards.forEach(symbol => { const cardElement = document.createElement('div'); cardElement.classList.add('card-2'); cardElement.dataset.symbol = symbol; cardElement.innerHTML = `<div class="card-face card-front"></div><div class="card-face card-back">${symbol}</div>`; cardElement.addEventListener('click', () => flipCard2(cardElement)); gameBoard.appendChild(cardElement); }); }
    function flipCard2(card) { if (lockBoard2 || card.classList.contains('is-flipped') || card.classList.contains('is-matched')) return; card.classList.add('is-flipped'); flippedCards2.push(card); if (flippedCards2.length === 2) checkForMatch2(); }
    function checkForMatch2() { lockBoard2 = true; const [cardOne, cardTwo] = flippedCards2; if (cardOne.dataset.symbol === cardTwo.dataset.symbol) disableCards2(); else unflipCards2(); }
    function disableCards2() { flippedCards2.forEach(card => card.classList.add('is-matched')); matchedPairs2++; resetBoard2(); if (matchedPairs2 === 6) { document.getElementById('result-memory-2').innerHTML = `<span style="color:blue;">ì„±ê³µ! ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸: <strong>5</strong></span>`; } }
    function unflipCards2() { setTimeout(() => { flippedCards2.forEach(card => card.classList.remove('is-flipped')); resetBoard2(); }, 1000); }
    function resetBoard2() { [flippedCards2, lockBoard2] = [[], false]; }

    function checkPassword2() {
        if (document.getElementById('password-2').value === '2025') {
            clearInterval(timerInterval2);
            alert('2ë‹¨ê³„ íƒˆì¶œ ì„±ê³µ! ë§ˆì§€ë§‰ 3ë‹¨ê³„ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
            document.getElementById('stage2-container').style.display = 'none';
            document.getElementById('stage3-container').style.display = 'block';
            startTime3 = new Date();
            timerInterval3 = setInterval(updateTimer3, 1000);
        } else {
            document.getElementById('escape-result-2').innerHTML = `<span style="color:red;">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.</span>`;
        }
    }
    
    // ==========================================================
    // --- 3ë‹¨ê³„ (í™”ì¥ì‹¤) ìŠ¤í¬ë¦½íŠ¸ ---
    // ==========================================================
    document.getElementById('urinal-3').addEventListener('click', () => document.getElementById('puzzle1-container-3').style.display = 'flex');
    document.getElementById('sink-3').addEventListener('click', () => document.getElementById('puzzle2-container-3').style.display = 'flex');
    document.getElementById('trash-can-3').addEventListener('click', () => document.getElementById('puzzle3-container-3').style.display = 'flex');
    document.getElementById('toilet-paper-3').addEventListener('click', () => { document.getElementById('minigame-container-3').style.display = 'flex'; startBulletHellGame3(); });
    document.getElementById('toilet-3').addEventListener('click', () => document.getElementById('password-modal-3').style.display = 'flex');

    function checkAnswer3(puzzleNum, hint) { const selected = document.querySelector(`input[name="answer3_${puzzleNum}"]:checked`); const resultEl = document.getElementById(`result3_${puzzleNum}`); if (selected) { if (selected.value === 'correct') { resultEl.innerHTML = `<span style="color:blue;">ì •ë‹µì…ë‹ˆë‹¤! ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸: <strong>${hint}</strong></span>`; } else { resultEl.innerText = 'ì˜¤ë‹µì…ë‹ˆë‹¤. ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”.'; } } else { resultEl.innerText = 'ë‹µì„ ì„ íƒí•´ì£¼ì„¸ìš”.'; } }

    let player3, gameInterval3, gameTimeout3, gameActive3 = false;
    function startBulletHellGame3() { if(gameActive3) return; gameActive3 = true; player3 = document.getElementById('player-3'); player3.style.left = '185px'; const gameInfo = document.getElementById('game-info-3'); gameInfo.classList.remove('password-hint'); gameInfo.style.color = 'black'; let count = 3; gameInfo.innerText = count; const countdown = setInterval(() => { count--; if (count > 0) { gameInfo.innerText = count; } else { gameInfo.innerText = "ì‹œì‘!"; clearInterval(countdown); gameTimeout3 = setTimeout(gameWin3, 15000); gameInterval3 = setInterval(createBullet3, 200); let timeLeft = 15; const timerDisplay = setInterval(() => { timeLeft--; if(gameActive3) gameInfo.innerText = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`; if(timeLeft <= 0) clearInterval(timerDisplay); }, 1000); } }, 1000); document.addEventListener('keydown', movePlayer3); }
    function closeMiniGame3(){ document.getElementById('minigame-container-3').style.display = 'none'; gameOver3(false); }
    function createBullet3() { const gameArea = document.getElementById('bullet-hell-game-3'); const bullet = document.createElement('div'); bullet.classList.add('bullet-3'); bullet.innerHTML = 'ğŸ’§'; bullet.style.left = Math.random() * 380 + 'px'; gameArea.appendChild(bullet); let top = -20; const fallSpeed = 2 + Math.random() * 3; const moveInterval = setInterval(() => { if(!gameActive3) { clearInterval(moveInterval); bullet.remove(); return; } top += fallSpeed; bullet.style.top = top + 'px'; if (isColliding3(player3, bullet)) { gameOver3(true); } if (top > 300) { clearInterval(moveInterval); bullet.remove(); } }, 20); }
    function isColliding3(player, bullet){ if(!player || !bullet) return false; const playerRect = player.getBoundingClientRect(); const bulletRect = bullet.getBoundingClientRect(); return !(playerRect.right < bulletRect.left || playerRect.left > bulletRect.right || playerRect.bottom < bulletRect.top || playerRect.top > bulletRect.bottom); }
    function movePlayer3(e) { if (!gameActive3) return; let playerX = parseInt(player3.style.left); if (e.key === 'ArrowLeft') { playerX -= 15; } else if (e.key === 'ArrowRight') { playerX += 15; } if (playerX < 0) playerX = 0; if (playerX > 370) playerX = 370; player3.style.left = playerX + 'px'; }
    function gameWin3() { if(!gameActive3) return; const gameInfo = document.getElementById('game-info-3'); gameInfo.innerHTML = `<span style="color:blue;">ì„±ê³µ! ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸: <strong>7</strong></span>`; endGame3(); }
    function gameOver3(showMsg) { if(!gameActive3) return; if(showMsg){ document.getElementById('game-info-3').innerHTML = `<span style="color:red;">ì‹¤íŒ¨! ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”.</span>`; } endGame3(); }
    function endGame3(){ gameActive3 = false; clearInterval(gameInterval3); clearTimeout(gameTimeout3); document.removeEventListener('keydown', movePlayer3); document.querySelectorAll('.bullet-3').forEach(b => b.remove()); }

    function checkPassword3() {
        if (document.getElementById('password-3').value === '0627') {
            clearInterval(timerInterval3);
            const time1 = document.getElementById('time-elapsed-1').innerText;
            const time2 = document.getElementById('time-elapsed-2').innerText;
            const time3 = document.getElementById('time-elapsed-3').innerText;
            document.getElementById('escape-result-3').innerHTML = `<span style="color:green; font-weight:bold;">ìµœì¢… íƒˆì¶œ ì„±ê³µ! ì¶•í•˜í•©ë‹ˆë‹¤!<br>(1ë‹¨ê³„: ${time1}) (2ë‹¨ê³„: ${time2}) (3ë‹¨ê³„: ${time3})</span>`;
        } else {
            document.getElementById('escape-result-3').innerHTML = `<span style="color:red;">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.</span>`;
        }
    }
</script>

</body>
</html>
